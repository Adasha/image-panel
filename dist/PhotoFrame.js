"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _createSuper(i){var a=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,a?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var i="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _construct(e,t,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,i){var a=[null];a.push.apply(a,t);var r=new(Function.bind.apply(e,a));return i&&_setPrototypeOf(r,i.prototype),r}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classPrivateMethodGet(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function _classPrivateFieldGet(e,t){var i=t.get(e);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(e):i.value}function _classPrivateFieldSet(e,t,i){var a=t.get(e);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(e,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}var _shadow=new WeakMap,_imgLoader=new WeakMap,_imgArr=new WeakMap,_currImg=new WeakMap,_masterPath=new WeakMap,_defaultSlideInterval=new WeakMap,_defaultTransitionDuration=new WeakMap,_timer=new WeakMap,_slideInterval=new WeakMap,_transDur=new WeakMap,_slideTemplate=new WeakMap,_slideStyle=new WeakMap,_upgradeProperty=new WeakSet,_loadData=new WeakSet,_dataLoaded=new WeakSet,_dataLoadingFailed=new WeakSet,_slideLoaded=new WeakSet,_slideLoadingError=new WeakSet,PhotoFrame=function(){_inherits(s,_wrapNativeSuper(HTMLElement));var r=_createSuper(s);function s(){var e;_classCallCheck(this,s);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=r.call.apply(r,[this].concat(i)),_slideLoadingError.add(_assertThisInitialized(e)),_slideLoaded.add(_assertThisInitialized(e)),_dataLoadingFailed.add(_assertThisInitialized(e)),_dataLoaded.add(_assertThisInitialized(e)),_loadData.add(_assertThisInitialized(e)),_upgradeProperty.add(_assertThisInitialized(e)),_shadow.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_imgLoader.set(_assertThisInitialized(e),{writable:!0,value:new Image}),_imgArr.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_currImg.set(_assertThisInitialized(e),{writable:!0,value:0}),_masterPath.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_defaultSlideInterval.set(_assertThisInitialized(e),{writable:!0,value:6e3}),_defaultTransitionDuration.set(_assertThisInitialized(e),{writable:!0,value:0}),_timer.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_slideInterval.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_transDur.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_slideTemplate.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_slideStyle.set(_assertThisInitialized(e),{writable:!0,value:"\n        background-repeat:   no-repeat;\n        background-position: center center;\n        background-size:     cover;\n        position: absolute;\n        left:   0;\n        right:  0;\n        bottom: 0;\n        top:    0;\n    "}),console.log("Element constructed."),_classPrivateFieldSet(_assertThisInitialized(e),_shadow,e.attachShadow({mode:"closed"})),_classPrivateFieldGet(_assertThisInitialized(e),_imgLoader).addEventListener("load",_classPrivateMethodGet(_assertThisInitialized(e),_slideLoaded,_slideLoaded2).bind(_assertThisInitialized(e))),_classPrivateFieldGet(_assertThisInitialized(e),_imgLoader).addEventListener("error",_classPrivateMethodGet(_assertThisInitialized(e),_slideLoadingError,_slideLoadingError2).bind(_assertThisInitialized(e))),e.style="\n            display: block;\n            position: relative;\n            width:  100%;\n            height: 100%;\n        ",e}return _createClass(s,null,[{key:"observedAttributes",get:function(){return["data","width","height","interval"]}}]),_createClass(s,[{key:"startSlideshow",value:function(e){console.log("Slideshow started."),this.loadSlide(e||0)}},{key:"stopSlideshow",value:function(){console.log("Slideshow stopped.")}},{key:"loadSlide",value:function(e){console.log("Loading slide "+(e+1)+" of "+_classPrivateFieldGet(this,_imgArr).length);var t=_classPrivateFieldGet(this,_masterPath)+_classPrivateFieldGet(this,_imgArr)[e].src;_classPrivateFieldSet(this,_currImg,e),_classPrivateFieldGet(this,_imgLoader).src=t}},{key:"prevSlide",value:function(){}},{key:"nextSlide",value:function(){_classPrivateFieldSet(this,_currImg,_classPrivateFieldSet(this,_currImg,+_classPrivateFieldGet(this,_currImg)+1)%_classPrivateFieldGet(this,_imgArr).length),this.loadSlide(_classPrivateFieldGet(this,_currImg))}},{key:"pauseTimer",value:function(){_classPrivateFieldGet(this,_timer)&&_classPrivateFieldGet(this,_timer).pause()}},{key:"resumeTimer",value:function(){_classPrivateFieldGet(this,_timer)&&_classPrivateFieldGet(this,_timer).resume()}},{key:"connectedCallback",value:function(){console.log("Element connected."),_classPrivateFieldSet(this,_slideTemplate,document.createElement("div")),_classPrivateFieldGet(this,_slideTemplate).className="image-slide",_classPrivateFieldGet(this,_slideTemplate).style=String(_classPrivateFieldGet(this,_slideStyle))}},{key:"disconnectedCallback",value:function(){console.log("Element disconnected.")}},{key:"attributeChangedCallback",value:function(e,t,i){switch(console.log("Attribute changed: "+e+". New value: "+i),e){case"data":_classPrivateMethodGet(this,_loadData,_loadData2).call(this,i)}}},{key:"data",get:function(){return this.getAttribute("data")},set:function(e){this.setAttribute("data",e)}},{key:"width",get:function(){return this.getAttribute("width")},set:function(e){this.setAttribute("width",e)}},{key:"height",get:function(){return this.getAttribute("height")},set:function(e){this.setAttribute("height",e)}},{key:"interval",get:function(){return this.getAttribute("interval")},set:function(e){this.setAttribute("interval",e)}}]),s}(),_upgradeProperty2=function(e){var t;this.hasOwnProperty(e)&&(t=this[e],delete this[e],this[e]=t)},_loadData2=function(e){var t=this;console.log("Loading data from "+e);var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?_classPrivateMethodGet(t,_dataLoaded,_dataLoaded2).call(t,JSON.parse(i.responseText)):_classPrivateMethodGet(t,_dataLoadingFailed,_dataLoadingFailed2).call(t,i))},i.open("GET",e,!0),i.send()},_dataLoaded2=function(e){console.log("Data loaded successfully."),_classPrivateFieldSet(this,_imgArr,Array.isArray(e)?e:e.slides),_classPrivateFieldSet(this,_masterPath,e.masterPath||""),_classPrivateFieldSet(this,_slideInterval,e.slideInterval||_classPrivateFieldGet(this,_defaultSlideInterval)),_classPrivateFieldSet(this,_transDur,e.transitionDuration||_classPrivateFieldGet(this,_defaultTransitionDuration)),e.shuffleSlides&&Utils.shuffleArray(_classPrivateFieldGet(this,_imgArr)),this.startSlideshow()},_dataLoadingFailed2=function(e){console.log("Data loading failed."),console.log(e)},_slideLoaded2=function(){var e=this;console.log("Slide loaded.");var t=_classPrivateFieldGet(this,_shadow).querySelector("*.image-slide"),i=_classPrivateFieldGet(this,_slideTemplate).cloneNode(!0),a=_classPrivateFieldGet(this,_imgArr)[_classPrivateFieldGet(this,_currImg)];i.setAttribute("style",a.style||""),i.style.backgroundImage="url("+(_classPrivateFieldGet(this,_masterPath)+a.src)+")",i.style.position="absolute",i.style.top="0",i.style.right="0",i.style.bottom="0",i.style.left="0",i.style.backgroundRepeat="no-repeat",i.style.backgroundSize="cover",t&&(t.style.opacity="1",t.style.zIndex="-1",i.style.zIndex="1"),_classPrivateFieldGet(this,_shadow).insertBefore(i,t),i.animate([{opacity:"0"},{opacity:"1"}],this.interval).addEventListener("finish",function(){console.log(i.style.opacity),t&&_classPrivateFieldGet(e,_shadow).removeChild(t),_classPrivateFieldSet(e,_timer,new Timer(e.nextSlide.bind(e),_classPrivateFieldGet(e,_slideInterval)))})},_slideLoadingError2=function(e){console.log('[Slideshow] Image loading failed: "'+e.target.src+'"'),this.nextSlide()};customElements.define("photo-frame",PhotoFrame);var _timerID=new WeakMap,_start=new WeakMap,_remaining=new WeakMap,_callback=new WeakMap,Timer=function(){function i(e,t){_classCallCheck(this,i),_timerID.set(this,{writable:!0,value:void 0}),_start.set(this,{writable:!0,value:void 0}),_remaining.set(this,{writable:!0,value:void 0}),_callback.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_callback,e),_classPrivateFieldSet(this,_remaining,t),this.resume()}return _createClass(i,[{key:"pause",value:function(){_classPrivateFieldGet(this,_timerID)&&(window.clearTimeout(_classPrivateFieldGet(this,_timerID)),_classPrivateFieldSet(this,_remaining,_classPrivateFieldGet(this,_remaining)-(new Date-_classPrivateFieldGet(this,_start))),_classPrivateFieldSet(this,_timerID,null))}},{key:"resume",value:function(){_classPrivateFieldGet(this,_timerID)&&window.clearTimeout(_classPrivateFieldGet(this,_timerID)),_classPrivateFieldSet(this,_start,new Date),_classPrivateFieldSet(this,_timerID,window.setTimeout(_classPrivateFieldGet(this,_callback),_classPrivateFieldGet(this,_remaining)))}}]),i}(),Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"shuffleArray",value:function(e){for(var t,i,a=e.length-1;0<a;a--)t=Math.floor(Math.random()*(a+1)),i=e[a],e[a]=e[t],e[t]=i;return e}}]),e}();